<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Compiling From Source</title>

		<meta name="description" content="A presentation about how to compile from source.">
		<meta name="author" content="averageradical">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">

		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>Compiling Source</h1>
					<p><small>Live presentation @ <a href="http://averageradical.github.io/compile/#/">http://averageradical.github.io/compile/#/</a></small></p>
					<p><small>Source of this presentation @ <a href="https://github.com/averageradical/compile">https://github.com/averageradical/compile</a></small></p>
				</section>

				<section>
					<h2>Agenda</h2>
					<ul>
						<li>Why?</li>
						<li>Limitations</li>
						<li>How?</li>
						<li>Examples</li>
					</ul>
				</section>

				<section>
					<h2>Why compile?</h2>
					<ul>
						<li>Learn/Play.</li>
						<li>Make modifications.</li>
						<li>Improve and contribute.</li>
						<li>Verify what you're running.</li>
					</ul>
				</section>

				<section>
					<h2>Limitations</h2>
					<p>Open source doesn't necessarily mean it's more secure.</p>
					<p>The <a href="http://heartbleed.com/">Heartbleed Bug</a> was in the wild for more than 2 years.</p>
					<p>At the time, OpenSSL was a popular package and the vulnerability affected more than 15% of all secure websites.</p>
				</section>

				<section>
					<h2>Limitations</h2>
					<p>Difficult to verify anything you download.</p>
					<p>If attacker has server's <a href="https://eprint.iacr.org/2014/150.pdf">TLS private key</a>.</p>
					<p>If attacker <a href="http://files.cloudprivacy.net/ssl-mitm.pdf">manipulates</a> certificate authority.</p>
					<p>Corollary: How do you know the Tor browser or Tails LiveCD you downloaded is legitimate?</p>
				</section>

				<section>
					<h2>Limitations</h2>
					<blockquote cite="http://cm.bell-labs.com/who/ken/trust.html">&ldquo;You can't trust code that you did not totally create yourself... No amount of source-level verification or scrutiny will protect you from using untrusted code. In demonstrating the possibility of this kind of attack, I picked on the C compiler. I could have picked on any program-handling program such as an assembler, a loader, or even hardware microcode. As the level of program gets lower, these bugs will be harder and harder to detect. A well installed microcode bug will be almost impossible to detect.&rdquo; - Ken Thompson (Bell Labs, Unix, Go, UTF-8)</blockquote>
				</section>

				<section>
					<h2>How?</h2>
					<p>Compile in Linux. In general, easier, problems less likely.</p>
					<p>If you're on Mac or Windows, run Linux in a Virtual Machine:</p>
					<ul>
						<li><a href="http://www.virtualbox.org/">VirtualBox</a> (Linux/Mac/Windows)</li>
						<li><a href="http://wiki.qemu.org/Main_Page">QEMU/KVM</a> (Linux/Mac)</li>
						<li><a href="http://www.microsoft.com/windows/virtual-pc/">Windows Virtual PC</a> (Windows)</li>
					</ul>
				</section>

				<section>
					<h2>Linux</h2>
					<p>Many flavors of Linux. Compilation instructions vary.</p>
					<p>I prefer Fedora+KDE. Examples:</p>
					<ul>
						<li><a href="http://spins.fedoraproject.org/">Fedora</a></li>
						<li><a href="http://www.ubuntu.com/">Ubuntu</a></li>
						<li><a href="http://www.linuxmint.com/">Mint</a></li>
						<li><a href="https://tails.boum.org/">Tails</a></li>
						<li><a href="https://www.gentoo.org/">Gentoo</a></li>
					</ul>
				</section>

				<section>
					<h2>What</h2>
					<ul>
						<li><a href="https://github.com/bitcoin/bitcoin">Bitcoin Core</a>: bitcoind and bitcoin-qt</li>
						<li><a href="https://bitcoinarmory.com/">Bitcoin Armory</a>: Desktop Bitcoin Wallet</li>
						<li><a href="https://github.com/schildbach/bitcoin-wallet">bitcoin-wallet</a>: Android Bitcoin Wallet</li>
					</ul>
				</section>

				<section>
					<h2>Compile Steps</h2>
					<ol>
						<li>Review License</li>
						<li>Download Source(s)</li>
						<li>Read Instructions</li>
						<li>Compile</li>
						<li>Install</li>
					</ol>
				</section>

				<section>
					<h2>Licenses</h2>
					<p>Projects have license in README, COPYING or LICENSE file.</p>
					<p>If no license, view website's terms (e.g. Github is <a href="http://choosealicense.com/no-license/">impermissive</a>).</p>
					<ul>
						<li><a href="http://choosealicense.com/licenses/mit">MIT</a> and <a href="http://choosealicense.com/licenses/isc/">BSD</a>: Permissive. Attribute.</li>
						<li><a href="http://choosealicense.com/licenses/gpl-v2">GPL</a>: Share modifications if distributed.</li>
						<li><a href="http://opensource.org/licenses/AGPL-3.0">AGPL</a>: Share modifications if distributed or served.</li>
						<li><a href="http://choosealicense.com/licenses/apache/">Apache</a>: Permissive. Grants patent rights.</li>
						<li><a href="https://creativecommons.org/choose/zero/">Public Domain (e.g. CC0)</a>: Permissive.</li>
						<li>Others: LGPL, Mozilla, Eclipse, Berne, etc.</li>
					</ul>
				</section>

				<section>
					<h2>Download Source(s)</h2>
					<p>Sources either ZIPs/Tarballs or in a repository (e.g. Github.com).</p>
					<p>Project websites/READMEs often have instructions.</p>
					<p>e.g., BitcoinArmory.com &gt; Download &gt; <a href="https://bitcoinarmory.com/download/building-armory-from-source/">Building From Source</a></p>
					<p>Optionally, verify signature (remember caveats from first slides).</p>
				</section>

				<section>
					<h2>Instructions</h2>
					<p>Instructions usually on the website or in the source package.</p>
					<p>In package, text file often called README, NOTES, or INSTALL.</p>
					<p>Instructions often list dependencies you need to install (compiler, libraries, etc.).</p>
				</section>

				<section>
					<h2>Compile</h2>
					<p>Compilers depend on the type of code. GUI:</p>
					<ul>
						<li>Android: <a href="http://developer.android.com/sdk/index.html">Java/AndroidSDK</a></li>
						<li>iOS: <a href="https://developer.apple.com/xcode/">Objective-C/Xcode</a></li>
						<li>Windows: <a href="http://www.visualstudio.com/en-us/products/visual-studio-express-vs.aspx">C++/.NET/Visual Studio</a></li>
						<li>Linux-Gnome: <a href="http://www.gtk.org/">C++/GTK+</a></li>
						<li>Linux-KDE: <a href="http://qt-project.org/">C++/QT</a></li>
						<li>Linux-Python: <a href="http://pythonqt.sourceforge.net/">Python/QT</a></li>
						<li><a href="https://www.java.com/en/">Java/Swing/SWT</a>, <a href="http://maven.apache.org/">Maven</a></li>
					</ul>
				</section>

				<section>
					<h2>Install</h2>
					<p>Compilers produce executables or binaries:</p>
					<ul>
						<li>Android: APK. Download, enable "Unknown Sources," open.</li>
						<li>iOS: IPA. Installation complicated.</li>
						<li>Windows: EXE or MSI.</li>
						<li>Linux: ELF EXE, Shell script, Python script, etc.</li>
						<li>Mac: DMG.</li>
					</ul>
				</section>

				<section>
					<h1>DEMO</h1>
				</section>

				<section>
					<h2>Demo Environment</h2>
					<ol>
						<li>Install <a href="https://www.virtualbox.org/wiki/Downloads">VirtualBox</a></li>
						<li>Download <a href="http://download.fedoraproject.org/pub/fedora/linux/releases/20/Live/x86_64/Fedora-Live-KDE-x86_64-20-1.iso">Fedora KDE 64-bit ISO</a></li>
						<li>Start VirtualBox &gt; New &gt; Type=Linux/Fedora (64-bit)</li>
						<li>Create Virtual Hard Drive (VirtualBox Disk Image), 40GB</li>
						<li>Click Start and select the ISO file</li>
						<li>Once Fedora starts, click Install to Hard Drive</li>
						<li>Install with defaults, create root password and normal user (check 'Make Administrator')</li>
						<li>Click Start &gt; Leave &gt; Shut down</li>
						<li>Right Click on VM &gt; Settings &gt; Storage &gt; Select the ISO under Controller:IDE &gt; On the right, click the CD button &gt; Remove disk &gt; OK &gt; Start</li>
						<li>Login with normal user/password</li>
						<li>Click Start and type Konsole</li>
					</ol>
				</section>

				<section>
					<h2>Fedora Dependencies</h2>
					<p>Dependencies needed for this presentation:</p>
					<pre><code data-trim>
$ sudo yum update -y
$ reboot # If kernel was updated
$ sudo yum groupinstall -y "Development Tools" "Development Libraries"
$ sudo yum install -y gcc-c++ libtool swig pyqt4-devel python-psutil python-twisted wget protobuf-devel maven glibc.i686 glibc-devel.i686 libstdc++.i686 zlib-devel.i686 ncurses-devel.i686 libX11-devel.i686 libXrender.i686 libXrandr.i686
</code></pre>
				</section>

				<section>
					<h2>Example: bitcoind/bitcoin-qt</h2>
					<pre><code data-trim>
$ wget -qO- 'http://download.oracle.com/berkeley-db/db-4.8.30.NC.tar.gz' | tar -xzv &amp;&amp; cd db*/build_unix
$ ../dist/configure --enable-cxx --disable-shared --with-pic --prefix=/usr/local/
$ make
$ sudo make install
$ cd; wget -qO- https://www.openssl.org/source/openssl-1.0.1i.tar.gz | tar -xzv &amp;&amp; cd o*
$ export CFLAGS="-fPIC"; ./config --prefix=/usr/local shared enable-ec enable-ecdh enable-ecdsa
$ make depend &amp;&amp; make all
$ sudo make install
$ cd; git clone git://github.com/bitcoin/bitcoin.git; cd bitcoin
$ ./autogen.sh &amp;&amp; ./configure LDFLAGS="-Wl,-rpath=/usr/local/lib64 -L/usr/local/lib/ -L/usr/local/lib64/" CPPFLAGS="-I/usr/local/include/"
$ make
$ sudo make install
$ mkdir ~/.bitcoin; wget -O ~/.bitcoin/bitcoin.conf https://raw.githubusercontent.com/averageradical/compile/gh-pages/example/bitcoin.conf
$ bitcoin-qt # or nohup bitcoind &amp;
$ bitcoin-cli help
</code></pre>
				</section>

				<section>
					<h2>Example: BitcoinArmory</h2>
					<ul>
						<li>Download Sources: <pre><code data-trim>$ cd; git clone git://github.com/etotheipi/BitcoinArmory.git
$ cd BitcoinArmory</code></pre></li>
						<li>Compile: <pre><code data-trim>$ make</code></pre></li>
						<li>Run: <pre><code data-trim>$ python ArmoryQt.py</code></pre></li>
					</ul>
				</section>

				<section>
					<h2>Modify</h2>
					<p>Learning all the code takes time. Reverse engineer at first.</p>
					<p>Recursive grep is a good place to start. Let's change the title:</p>
					<pre><code data-trim>$ grep -R "Bitcoin Wallet Management" *</code></pre>
					<p>Edit ArmoyQt.py, go to line 97, change it, and re-run.</p>
				</section>

				<section>
					<h2>Example: bitcoin-wallet</h2>
					<ul>
						<li>Download Android SDK: <pre><code data-trim>$ cd; wget -qO- https://dl.google.com/android/android-sdk_r23.0.2-linux.tgz | tar xzv
$ android-sdk-linux/tools/android update sdk --no-ui --filter platform,platform-tool,tool,build-tools-20.0.0</code></pre></li>
						<li>Download Sources: <pre><code data-trim>$ git clone https://github.com/schildbach/bitcoin-wallet.git
$ cd bitcoin-wallet</code></pre></li>
						<li>Patch (<a href="https://github.com/schildbach/bitcoin-wallet/blob/master/wallet/README#L57">why</a>): <pre><code data-trim>$ sed -i 's/3.7.0/3.8.2/g' pom.xml</code></pre></li>
						<li>Compile: <pre><code data-trim>$ mvn clean install -Dandroid.sdk.path=/home/`whoami`/android-sdk-linux/</code></pre></li>
						<li>APKs under wallet/target</li>
					</ul>
				</section>

				<section>
					<h2>Tips</h2>
					<ul>
						<li>Building is a game of whac-a-mole with errors. When searching online, some answers are bad, so a VM is good.</li>
						<li>When using ./configure, it often bails with an error. Install the required dependency and re-run.</li>
						<li>After making a change, run the build again (e.g. make) and it should only recompile what's necessary.</li>
						<li>It's not easy to interpret compiler output. In general, "warning" is okay, "error" is bad.</li>
					</ul>
				</section>

				<section>
					<h1>THE END</h1>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
				slideNumber: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Parallax scrolling
				// parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
				// parallaxBackgroundSize: '2100px 900px',

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
